<!doctype html><html lang=en-us><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=theme-color content="dark"><title>Leaf color change in 10,950 iNaturalist observations | Etowah Adams</title><meta property="og:site_name" content="Etowah Adams"><meta property="og:title" content="Leaf color change in 10,950 iNaturalist observations | Etowah Adams"><meta itemprop=name content="Leaf color change in 10,950 iNaturalist observations | Etowah Adams"><meta name=twitter:title content="Leaf color change in 10,950 iNaturalist observations | Etowah Adams"><meta name=application-name content="Leaf color change in 10,950 iNaturalist observations | Etowah Adams"><meta name=twitter:card content="summary"><meta name=description content="Bringing fall observations to life by analyzing red maple leaf color in 10,950 iNaturalist observations"><meta name=twitter:description content="Bringing fall observations to life by analyzing red maple leaf color in 10,950 iNaturalist observations "><meta itemprop=description content=" Bringing fall observations to life by analyzing red maple leaf color in 10,950 iNaturalist observations "><meta property="og:description" content=" Bringing fall observations to life by analyzing red maple leaf color in 10,950 iNaturalist observations "><meta property="og:type" content="article"><meta property="article:publisher" content="Etowah Adams"><meta property="og:article:published_time" content="2020-01-09T21:19:07-0500"><meta property="article:published_time" content="2020-01-09T21:19:07-0500"><script defer type=application/ld+json>{"@context":"http://schema.org","@type":"Article","headline":"Leaf color change in 10,950 iNaturalist observations","author":{"@type":"Person","name":"Etowah Adams"},"datePublished":"2020-01-09","description":"Bringing fall observations to life by analyzing red maple leaf color in 10,950 iNaturalist observations","wordCount":1274,"mainEntityOfPage":"True","dateModified":"2020-01-09","publisher":{"@type":"Organization","name":"Etowah Adams","logo":{"@type":"imageObject","url":"https:\/\/etowahadams.github.io\/favicon.ico"}}}</script><link rel="shortcut icon" type=image/x-icon href=/favicon.ico><link rel=stylesheet href=/sass/main.min.ab99ff095f832511e24ffb2fba2b51ad473b2f7e9301d674eba2c6c3a6e8bd81.css></head><script>(function(){const e="ThemeColorScheme";localStorage.setItem(e,"light")})()</script><script>(function(){const t="ThemeColorScheme",e=localStorage.getItem(t),n=window.matchMedia("(prefers-color-scheme: dark)").matches===!0;e=="dark"||e==="auto"&&n?document.documentElement.dataset.userColorScheme="dark":document.documentElement.dataset.userColorScheme="light"})()</script><body class=dark><nav class=navbar><div class=container><div class=flex><div><a class=brand href=/>Etowah Adams</a></div><div class=flex><a href=/articles/>Articles</a></div></div></div></nav><main><div class=container><article><header class=article-header><div class=thumb><div><h1>Leaf color change in 10,950 iNaturalist observations</h1><div class=post-meta><div>By Etowah Adams | <time>January 09, 2020</time>
| 6 minutes</div><div class=tags></div></div></div></div></header></article><div class=article-post><figure><a data-fancybox href=process.jpg data-caption="Process overview. Skip to process explanation"><img src=process.jpg data-src=process.jpg class=lazyload alt></a><figcaption style=text-align:left>Process overview. <a href=#process>Skip to process explanation</a></figcaption></figure><p>One of the unexpected consequences of attending college in Connecticut has been experiencing autumn twice a year. I watch the trees of New Haven<sup id=fnref:1><a href=#fn:1 class=footnote-ref role=doc-noteref>1</a></sup> change color during late October and early November, then return home in Georgia for fall break and watch the leaves change color again.</p><p>I understood the basic principle behind my double-dipping of fall. In late October, Connecticut is colder and receives less daylight hours than my home in Georgia, triggering trees stop making green chlorophyll and allowing the yellows, oranges, and reds of the other pigments (like xanthophylls, carotenoids, and anthocyanins) to become visible earlier. However, I began to wonder when autumn came to other parts of North America, and the rate that it moved. I have seen fall color forecasts. But what would it look like actually to observe leaf color change across the whole continent? I decided to tackle this question over my winter break.</p><p>Having been a contributor for several years now, I turned to <a href=https://www.inaturalist.org/>iNatrualist</a> for answers. For the uninitiated, iNaturalist is a website where users can submit and identify observations of any taxa of life: a social media for naturalists in a sense. I had three qualifications choosing a tree species. It had to have a drastic fall color change, a large range, and many observations. After considering Sugar Maple, (<em>Acer saccharum</em>), Sassafras (<em>Sassafras albidum</em>), Trembling Aspen (<em>Populus tremuloides</em>), among other trees, I finally decided on <a href=https://www.inaturalist.org/taxa/48098-Acer-rubrum>Red Maple</a> (<em>Acer rubrum</em>), which had the highest observation count.</p><h2 id=results><a href=#results class=anchor><svg class="icon" aria-hidden="true" focusable="false" height="16" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5.0-3-1.69-3-3.5S2.55 3 4 3h4c1.45.0 3 1.69 3 3.5.0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98.0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98.0-2-1.22-2-2.5.0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45.0 3-1.69 3-3.5S14.5 6 13 6z"/></svg></a>Results</h2><figure><video autoplay loop width=100% preload=auto>
<source src=2019.mp4 type=video/mp4></video><figcaption style=text-align:left><strong>Figure 1:</strong> 2019 research grade observations of <em>A. rubrum</em> with leaves. The color of each marker corresponds to the dominant color of the leaves in the respective observation. Each marker disappears 10 days (frames) after it first appears. At the end of April, observations get green as trees “green up,” and fall colors start appearing at the start of October and spread south.</figcaption></figure><figure><a data-fancybox href=observation-count.jpg data-caption="Figure 2 (left): Number of observations of A. rubrum versus week of the year. At the 17th week (around the 4th week of April) there is a sharp spike in the number of observations. I expect this to be when the first leaves first start coming out and everyone is submitting their first A. rubrum observation of the year. Figure 3 (right): Number of observations with leaves versus week of the year. As expected, there is not much difference between figure 2 and figure 3. People usually submit observations with leaves in them. However, notice that in weeks 1-16, there less observations compared to in figure 2, suggesting that the spike of observations at week 17 is because of the emergence of leaves. Still, the peak is remarkably high."><img src=observation-count.jpg data-src=observation-count.jpg class=lazyload alt></a><figcaption style=text-align:left><strong>Figure 2 (left)</strong>: Number of observations of A. rubrum versus week of the year. At the 17th week (around the 4th week of April) there is a sharp spike in the number of observations. I expect this to be when the first leaves first start coming out and everyone is submitting their first <em>A. rubrum</em> observation of the year. <strong>Figure 3 (right)</strong>: Number of observations with leaves versus week of the year. As expected, there is not much difference between figure 2 and figure 3. People usually submit observations with leaves in them. However, notice that in weeks 1-16, there less observations compared to in figure 2, suggesting that the spike of observations at week 17 is because of the emergence of leaves. Still, the peak is remarkably high.</figcaption></figure><figure><video autoplay loop width=100% preload=auto>
<source src=allyears.mp4 type=video/mp4></video><figcaption style=text-align:left><strong>Figure 4</strong>: 2016, 2017, 2018, and 2019 research grade observations of <em>A. rubrum</em> with leaves. 2015 omitted so that a nice square could be made</figcaption></figure><figure><a data-fancybox href=fall-colors.jpg data-caption="Figure 5: Number of observations with “fall” colors in each week of the year for 2015-2019. “Fall” color was defined in an HSV color model as colors with a hue (0-360) > 300 or < 60, a saturation (0-1) > 0.09, and a value (0-255) > 150. Peaks are present at week 17, and weeks 41-44. Week 17 is overrepresented because of the number of total observations in that week, but early leaves can be reddish. Interestingly the 2018 fall colors appear to be about two weeks later as a whole compared to 2019. The late 2018 fall was observed by others, and was attributed to higher than average daily low temperatures."><img src=fall-colors.jpg data-src=fall-colors.jpg class=lazyload alt></a><figcaption style=text-align:left><strong>Figure 5</strong>: Number of observations with “fall” colors in each week of the year for 2015-2019. “Fall” color was defined in an HSV color model as colors with a hue (0-360) > 300 or &lt; 60, a saturation (0-1) > 0.09, and a value (0-255) > 150. Peaks are present at week 17, and weeks 41-44. Week 17 is overrepresented because of the number of total observations in that week, but early leaves can be reddish. Interestingly the 2018 fall colors appear to be about two weeks later as a whole compared to 2019. The late 2018 fall was observed by <a href=https://weather.com/science/weather-explainers/news/2018-10-03-why-foliage-fall-color-is-late-warm-east>others</a>, and was attributed to higher than average daily low temperatures.</figcaption></figure><h2 id=process><a href=#process class=anchor><svg class="icon" aria-hidden="true" focusable="false" height="16" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5.0-3-1.69-3-3.5S2.55 3 4 3h4c1.45.0 3 1.69 3 3.5.0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98.0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98.0-2-1.22-2-2.5.0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45.0 3-1.69 3-3.5S14.5 6 13 6z"/></svg></a>Process</h2><p>I painstakingly looked through the images of all 10,000+ observations and wrote down each the color of the leaves in each observation.</p><p>Just kidding.</p><h3 id=leaf-detection><a href=#leaf-detection class=anchor><svg class="icon" aria-hidden="true" focusable="false" height="16" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5.0-3-1.69-3-3.5S2.55 3 4 3h4c1.45.0 3 1.69 3 3.5.0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98.0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98.0-2-1.22-2-2.5.0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45.0 3-1.69 3-3.5S14.5 6 13 6z"/></svg></a>Leaf Detection</h3><p>An observation’s images could contain branches, buds, bark, roots, seeds, and any number of other features to help with identification. So, I knew I had to detect if there was a leaf in in the image, and where the leaf was in the image. In other words, I was dealing with object detection. I chose a deep learning approach, You Look Only Once (YOLO), for object detection because of its speed and good documentation.</p><p>Using the <a href=https://api.inaturalist.org/v1/docs/>iNatrualist API</a>, I downloaded the images from every 10th page of research grade <em>A. rubrum</em> observations. I created a training set by labeling the leaves in 800 images using LabelImg and trained the model for 3500 batches (around 16 hours on my computer). In hindsight, I could have had even better accuracy if I had created additional classes for other features like branches and seeds, but overall, I am pleased with the performance of the model. There are several instances where it identified very small leaves, getting more sky than leaf, resulting several blue to white dominant color however. See the object detector on <a href=https://github.com/etowahs/leaf-detector>Github</a>.</p><figure><a data-fancybox href=leaf-detection.jpg data-caption="Figure 6: Leaves detected by YOLOv3 object detector trained on 800 labeled images"><img src=leaf-detection.jpg data-src=leaf-detection.jpg class=lazyload alt></a><figcaption style=text-align:left><strong>Figure 6</strong>: Leaves detected by YOLOv3 object detector trained on 800 labeled images</figcaption></figure><h3 id=leaf-color><a href=#leaf-color class=anchor><svg class="icon" aria-hidden="true" focusable="false" height="16" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5.0-3-1.69-3-3.5S2.55 3 4 3h4c1.45.0 3 1.69 3 3.5.0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98.0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98.0-2-1.22-2-2.5.0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45.0 3-1.69 3-3.5S14.5 6 13 6z"/></svg></a>Leaf Color</h3><p>Once I knew where the leaf was, I expected getting the leaf color to be easy, but it required more experimentation than I expected. At first, I tried to get the color of the leaf without doing any additional manipulation to the leaf sub-image. I used k-means clustering to get the dominant color of the image. I was surprised by how well k = 3 performed, but I thought I could get an even better color if I extracted the foreground.</p><figure><a data-fancybox href=domcolor.jpg data-caption="Figure 7: Dominant color using k-means clustering."><img src=domcolor.jpg data-src=domcolor.jpg class=lazyload alt></a><figcaption style=text-align:left><strong>Figure 7</strong>: Dominant color using k-means clustering.</figcaption></figure><p>I tried a variety of methods, including creating masks from the largest contour provided by canny edge detection and adaptive thresholding, but with limited success. Eventually I stumbled upon the grabcut algorithm, which performed miles better than anything I had come up with.</p><figure><a data-fancybox href=adaptive-thresholding2.jpg data-caption="Figure 8: Foreground extraction using mask created with the largest contour found using adaptive thresholding. Not terrible, but also not good."><img src=adaptive-thresholding2.jpg data-src=adaptive-thresholding2.jpg class=lazyload alt></a><figcaption style=text-align:left><strong>Figure 8</strong>: Foreground extraction using mask created with the largest contour found using adaptive thresholding. Not terrible, but also not good.</figcaption></figure><figure><a data-fancybox href=grabcut.jpg data-caption="Figure 9: Foreground extraction using grabcut, followed by k-means clustering (k = 2) of the foreground. Much better."><img src=grabcut.jpg data-src=grabcut.jpg class=lazyload alt></a><figcaption style=text-align:left><strong>Figure 9</strong>: Foreground extraction using grabcut, followed by k-means clustering (k = 2) of the foreground. Much better.</figcaption></figure><p>Grabcut worked well for leaves with defined edges, but for leaves with less defined leaf edges, sometimes it would cut out the entire foreground, which in case I would get the dominant color of the entire leaf sub-image. When an observation had multiple leaves, I got the dominant color (k = 2) of the dominant colors of each of the leaves. If I were to do it over, I would have combined the extracted leaf foregrounds into the same array, and taken the dominant color of that.</p><p>Once I got the main image processing pipeline set up, I ran it on the images with leaves in them for all the observations of <em>A. rubrum</em> between 2015-2019. See it on <a href=https://github.com/etowahs/leaf-colors>Github</a>.</p><h2 id=creating-the-graphics><a href=#creating-the-graphics class=anchor><svg class="icon" aria-hidden="true" focusable="false" height="16" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5.0-3-1.69-3-3.5S2.55 3 4 3h4c1.45.0 3 1.69 3 3.5.0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98.0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98.0-2-1.22-2-2.5.0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45.0 3-1.69 3-3.5S14.5 6 13 6z"/></svg></a>Creating the Graphics</h2><p>I initially created a map using leaflet.js but animating the markers was not smooth enough for my liking. Instead, for every day in each year I generated an SVG image. These images were combined into a gif, using Imagemagick, and then converted into a mp4 using ffmpeg. For a future project, I would like to try something with CSS sprite sheet animation, d3.js, or maybe even three.js, but for a long animation like this one, I think the gif was appropriate and is very sharable.</p><h2 id=concluding-thoughts><a href=#concluding-thoughts class=anchor><svg class="icon" aria-hidden="true" focusable="false" height="16" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5.0-3-1.69-3-3.5S2.55 3 4 3h4c1.45.0 3 1.69 3 3.5.0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98.0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98.0-2-1.22-2-2.5.0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45.0 3-1.69 3-3.5S14.5 6 13 6z"/></svg></a>Concluding Thoughts</h2><p>I found it fascinating to see leaf colors change across eastern North America. Observations are increasing every year so this type of visualization will only get better, although certainly they will be skewed towards certain geographic areas and time periods. Users tend to submit observations when they notice something different, so data mostly comes from periods of transitions. I was happy to see that the <a href=https://www.washingtonpost.com/weather/2018/10/19/weve-never-seen-anything-like-this-fall-foliage-still-missing-action-across-mid-atlantic/>late timing of fall colors of 2018</a> was reflected in figure 5.</p><div class=footnotes role=doc-endnotes><hr><ol><li id=fn:1><p>See this cool <a href=https://uri.yale.edu/maps/street-tree-inventory-map>map</a> of New Haven trees by Yale Urban Resource Initiative&#160;<a href=#fnref:1 class=footnote-backref role=doc-backlink>&#8617;&#xfe0e;</a></p></li></ol></div></div></div><div class=container><nav class="flex container suggested"><a rel=next href=/post/2024-07-17-cloning/ title="Next post (newer)"><span>Next</span>
Molecular cloning, or why some biologists become superstitious</a></nav></div><div class=container></div></main></main><footer class="footer flex"><section class=container><nav class=footer-links><a href=/index.xml>RSS</a></nav></section><script defer src=/ts/features.dd8e5b18a6dda91367e396fd8dc9b9f83a1993065f709a53e056e0f2e9096ea1.js data-enable-footnotes=true></script></footer></body></html>